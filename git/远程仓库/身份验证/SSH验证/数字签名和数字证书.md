# 数字签名和数字证书

<br><br>

## 目录

1. [数字签名](#一数字签名)
2. [数字签名的公钥信任问题](#二数字签名的公钥信任问题)
3. [数字证书：解决数字签名的公约信任问题](#三数字证书解决数字签名的公约信任问题--)

<br><br>

### 一、数字签名：[·](#目录)
> 之前已经讲过了，就是“明文+该明文用私钥加密过的密文”的组合.
>
>> 对方收到签名之后用公钥解密，看看解密出的结果是否和明文一致，如果一致则可证明发送方的身份.

- 实际应用中的数字签名：
  - 并没有直接采用“明文+该明文用私钥加密过的密文”，因为：
    - 一般处于安全性考虑，明文会取的非常长（为了防止被轻易破解）.
  - 而明文非常长所带来的问题非常明显：
    1. 加解密的时间会很久.
    2. 一般不想在身份验证的环节花去太长的时间.

<br>

- 因此，实际的做法是：
  1. 对明文进行Hash.
  2. 对Hash结果用私钥加密.
    - Hash结果称为**摘要**.
  3. 将**明文**、**明文的摘要**、**摘要的私钥加密结果** 打包共同作为**数字签名**.
  4. 接收方：
    1. 用相同的Hash函数（双方事先约定好）对明文Hash.
    2. 用公钥解密收到的摘要密文.
    3. 检验解密结果是否和发过来的摘要相同，如果相同则验证成功.

<br><br>

### 二、数字签名的公钥信任问题：[·](#目录)

- 情景：
  1. 坏蛋入侵了你的电脑，把你朋友的公钥换成了坏蛋的公钥.
  2. 然后坏蛋用自己的数字签名找你验签.
    - 由于你朋友的公钥被替换成坏蛋的了，但你还不知道，因此你用了坏蛋的公钥验签.
  3. 所以验签成功，但你还以为对面是你朋友.
  4. 进而你和坏蛋愉快地聊天，把你和你朋友之间的秘密都泄露给了坏蛋.

<br>

- 问题总结：
  - 虽然数字签名可以唯一地标示对方身份.
  - 但是，公钥却存在信任问题.
    1. 你电脑里的公钥存在被骇客攻击（替换）的风险.
      - 直接被攻击的可能性比较小，目前用户的自我安全意识以及流行的杀毒防护软件都能基本保证不被攻击.
    2. 安装了非法地、乱七八糟的公钥：这也是最常见的数字签名冒充形式
      - 假设你访问流氓网站后，该网站偷偷往你电脑里安装了假的支付宝公钥，该公钥实际属于钓鱼网站的.
      - 然后该流氓网站引导你进入了一个假的钓鱼的支付宝登录页面（做的跟真的很像）.
      - 假支付宝给你发来它的数字签名，然后你用事先**被**安装好的证书验签，结果验签成功.
        - 最后你傻乎乎地输入账号密码，当然结果就是密码被窃取了.
- **数字证书** 刚好解决了数字签名的公钥信任问题.

<br><br>

### 三、数字证书：解决数字签名的公约信任问题  [·](#目录)

- 解决问题的思路很简单：
  - 其实就是找一家第三方权威机构去验证手里的公钥是否就是我朋友的而不是其他人的.
  - 这个第三方权威机构的运作方式：
    1. 你的朋友必须将自己的公钥和个人基本的身份信息交给该机构.
    2. 该机构审核认证后将公钥和个人信息保存在数据库中.
    3. 当你收到数字签名的时候，你要先把你手上的公钥交给该机构认证.
      - 如果该公钥在该机构中注册过，那就将相应的个人身份信息发给你.
    4. 你拿到信息后确认该公钥确实属于你朋友而不是其他坏人，然后你就可以愉快地通信了.

<br>

- 具体实现：
  1. 证书中心：certificate authority，简称CA.
    - 就是第三方权威机构，专门用于验证公钥.
  2. CA的运作方式：
    1. 注册：通信发起方（就是你的朋友）必须先将自己的公钥和个人信息注册给CA，CA要经过严格的审核.
      - 这个很简单，大家都明白.
    2. 验证公钥：
      - 通信应答方打电话给CA，然后告诉对方手里的公钥，然后CA的管理员进入CA的数据库查看该公约是否是注册过的合法公钥，将结果回馈给用户.
        - 当然开玩笑了，不可能这样操作的，这只是一种形象地比喻.
        - 打电话告诉公钥的这种方式实在是太慢太低效了，有没高效、自动化的验证方式呢？
      - 其实CA自己也有一对公-私钥，CA用自己的私钥对注册信息（注册人的公钥和个人信息）进行加密，作为注册人的**数字证书**.
        - CA将自己的公钥发放给用户（通信应答方）.
        - CA的公钥就是**受信任的根证书**.
      - 实际验证流程：
        1. 通信发起方将自己数字签名和数字证书一并发给对方，对方收到后，先用CA的公钥（根证书）解密数字证书，解密后可以查看到对方的身份信息以及公钥.
          - 这个道理其实和打电话询问的原理是一样的.
          - 查看CA数据库并进行比对只有CA数据库管理员才有权限做，但如果直接将这个权限交给用户不就省去了管理员这个中间层了吗？
            - CA的私钥加密公钥解密其实就是管理员的道理，因为只有CA的公钥才能解开CA自己的私钥.
            - 这样都不需要数据库，因为数字证书本身就是“数据库”，这个数据只能是持有CA公钥的人才能解开.
        2. 然后用公钥验签即可.
  3. 两个公开：
    1. 一个人的数字证书是对外公开的.
    2. CA的公钥（根证书）是对外公开的.

<br>

- 数字证书的好处：
  1. 最明显的就是可以验证公钥.
  2. 没有保存和管理公钥的必要了，公钥直接包含在了数字证书中.

<br>

- 身份冒充问题的解决：
  1. 由于数字证书是公开的，因此别人可以冒用你的数字证书.
    - 这个**不存在安全问题**，因为：
      1. 虽然数字证书可以冒用，但私钥却无法被冒用，除非被盗取.
      2. 即使对方冒用了你朋友的数字证书，但对方没有你朋友的私钥.
        - 虽然你在证书中看到写着的是你朋友的名字.
        - 但对方只能用自己的私钥签名，而证书中的公钥是你朋友的.
          - 换句话说，无法用你朋友的公钥来解冒用你朋友证书的坏蛋的签名，因此冒用证书的攻击方法不成立.
          - 对于这种情况会直接决绝通信，提示你验签失败.
    - 如果坏蛋用自己的证书糊弄你就更不可能了，因为你可以从证书中看出上面的身份信息并不是你朋友，而是其他人.
      - 对于这种情况，你要自己识别证书上的身份，再决定是否继续通信.
        - 典型的是浏览器访问网站，如果是钓鱼网站冒充正规网站的数字证书，比如：taoba0冒充taobao
          - 一般正规网站的数字证书上一定会注明自己的网址，在这种情况下，浏览器就会提示你：证书上的网址是taobao，但你目前访问的网址是taoba0，存在风险，是否继续访问？
  2. CA冒充：
    - 钓鱼网站自己成立一个CA机构，然后给你的电脑安装一个它自己的所谓的“根证书”.
      - 用它的钓鱼根证书解密的数字证书写着你朋友的名字，但公钥却是钓鱼网站的公钥.
      - 这就彻底完蛋蛋了.
- 避免CA冒充带来的困扰：客户端的根证书管理
  1. 大多数OS以及系统安全软件都有监控浏览器根证书目录的功能，当你要安装一个根证书时都会自动帮你检测该根证书是否合法可信.
    - 例如360等.
  2. 必须要安装正规网站、机构的根证书.
  3. 查看浏览器安装的根证书：以Windows为例
    - Windows平台的各种浏览器都是以IE为内核的，因此只能通过IE来查看安装的根证书.
    - 查看流程：打开IE浏览器 -> 菜单 -> 工具 -> Internet选项 -> “内容”选项卡 -> 证书 -> “受信任的证书颁发机构”选项卡
      - 在其中可以看到安装的所有根证书.
      - 如果想手动安装的话，可以在当前选项卡中点击“导入”按钮，直接将根证书安装.
