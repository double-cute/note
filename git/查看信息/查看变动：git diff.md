# 查看变动：git diff
> 无非就是三种情形：都采用**git diff**命令（不同选项）实现.
>
>   1. 工作区相对于stage的改变.
>   2. 工作区相对于版本库的改变（一般是针对HEAD）.
>   3. stage相对于版本库的改变（一般也是针对HEAD）.

<br><br>

## 目录
1. [git diff的输出信息详解](#一git-diff的输出信息详解)
2. [git diff的各种用法](#二git-diff的各种用法)

| 命令 | 说明 |
| --- | --- |
| git diff [目标文件列表] | 工作区相对于stage的变化：+工作区, -stage |
| git diff **节点引用** [目标文件列表] | 工作区相对于某个版本库节点的变化：+工作区, -节点 |
| git diff **--staged\|cached 节点引用** [目标文件列表] | stage相对于某个版本库节点的变化：+stage, -节点 |

<br><br>

### 一、git diff的输出信息详解：[·](#目录)

- 示例：

```
$ git diff
diff --git a/test.txt b/test.txt
index 6f8a38c..449b072 100644
--- a/test.txt
+++ b/test.txt
@@ -1,7 +1,7 @@
 a
 a
 a
-a
+b
 a
 a
 a
```

- 接下来进行详细解析：

```
diff --git a/test.txt b/test.txt
```

1. diff --git
  - 表示采用的是**git格式的diff**.
  - Unix本身就有一个diff命令，它的输出格式与git diff相似但又不同.
  - GNU也有自己的diff输出格式，总之市面上有多种diff，这里表示使用的是git的diff.
2. a/test.txt b/test.txt
  - 表示改动前的test.txt和改动后的test.txt进行比较.
  - git diff统一采用**a/来表示改动前**的版本，用**b/来表示改动后**的版本，a/和b/并不代表文件路径.

```
index 6f8a38c..449b072 100644
```

1. 描述了目标文件（待比较文件test.txt）的基本信息.
2. index 6f8a38c表示test.txt这个文件在stage中的索引值.
  - stage中的文件保存在.git/index中.
3. 449b072表示test.txt这个文件在工作区中的对象编号.
  - git对工作区中文件的监控是通过“对象Object”进行的.
  - git为所有工作区中的文件（除了.gitignore之外的文件）赋予了一个对象编号.
4. 最后的100644（6位整数）表示test.txt这个文件的权限.
  - 末位的644表示普通文件.
5. 总结来说就是三点：**stage索引+工作区编号+权限信息**

```
--- a/test.txt
+++ b/test.txt
```

- git diff统一用-标识改动前的版本，+标识改动后的版本，就这么简单.
- 如果目标文件是新添加的（即改动前该文件并不存在），那么这里就会显示：--- /dev/null

```
@@ -1,7 +1,7 @@
```

- 接下来表示改动前和改动后文件的比较情况了.
- git diff采用合并diff格式来呈现比较结果.
  - 历史上diff共有三种输出格式：
    1. 正常格式（normal diff）.
    2. 上下文格式（context diff）.
    3. 合并格式（unified diff）.
  - 其中合并格式最为先进、简介、一目了然.
    - 它将改动前和改动后的文件合并在一起显示.
    - \-开头的行表示改动前的行.
    - +开头的行表示改动后的行.
    - 可以形象的理解为发生的改变为删除了\-开头的行同时添加了+开头的行.
- @@包裹的内容表示发生改动的位置信息.
  - \-1,7表示a/test.txt的**第1行开始**的**连续7行**相对于b/test.txt发生了变化.
  - +1,7表示b/test.txt的**第1行开始**的**连续7行**相对于a/test.txt发生了变化.
  - 虽然从结果上看只有第4行发生了变化，但为什么这里要显示7行呢？
    - 原因是git diff的显示原则，即必须**额外显示**出发生变化的地方的**前后各3行**的信息，因此会多出6行.
    - 也就是说**±n,len中的len等于发生变化的行数加6**（前后各3行）.
      - 因为将变化的上下文信息一并显示更加能快速定位变化的位置.

<br><br>

### 二、git diff的各种用法：[·](#目录)

- 一般形式：git diff [选项] [目标文件列表]
  - [选项]决定了工作区、stage、版本库三者谁和谁的比较.
  - [目标文件列表]决定了具体比较哪些文件.
    - 如果[目标文件列表]**不写** 则会比较**所有发生改变的文件**.
    - 加了[目标文件列表]则只比较目标文件们所发生的变化.

<br>

- 所有用法：

| 命令 | 说明 |
| --- | --- |
| git diff [目标文件列表] | 工作区相对于stage的变化：+工作区, -stage |
| git diff **节点引用** [目标文件列表] | 工作区相对于某个版本库节点的变化：+工作区, -节点 |
| git diff **--staged\|cached 节点引用** [目标文件列表] | stage相对于某个版本库节点的变化：+stage, -节点 |
