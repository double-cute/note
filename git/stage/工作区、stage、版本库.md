# 工作区、stage、版本库
> git不同于其它版本控制软件的精髓所在.

<br><br>

## 目录
1. [三者的概念和作用]()
2. [stage的原理]()
3. [设计stage的好处：可以更好的管理阶段性开发过程]()

<br><br>

### 一、三者的概念和作用：[·](#目录)

1. 工作区就是**.git/目录之外**的所有区域.
  - 它是**真实存在**可以由用户随意操作的**OS文件系统区域**.
    - 就是普通的OS文件夹/目录.
2. stage是**git管理维护**的**缓存区**.
  - 位于工作区和版本库之间，工作区将要提交到版本库中的内容可以缓存在其中.
  - stage的维护在.git/目录下进行.
  - **放入stage的文件将被git跟踪.**
    - 通过git add等跟踪操作可以将目标文件加入到stage中.
3. 版本库就是版本库咯！
  - 多节点多分支.
  - 每个节点都是一个完整的版本代码，代表不同的提交.
  - 可以在各个节点（版本）直接穿梭.
  - **只不过git的版本库中的节点只能来自stage.**
    - 只能通过git commit命令将stage中的目录树**保存成节点**（一个完整的版本）提交到版本库中.

<br><br>

### 二、stage的原理：[·](#目录)

- 宏观上看：
  1. stage是单节点，版本库是多节点.
  2. git commit的提交操作其实就是将stage节点插入到版本库中.
    - 同时将stage这个唯一的节点摘掉.
    - 形象的描述就是将stage摘下来插到版本库中.
      - 包含两步操作：
        1. 将stage节点插到版本库中.
        2. 清空stage（摘掉stage节点）.


- 节点的概念：
  1. 节点其实就是一颗**目录树**，就是**所有被跟踪的文件以及目录**构成的目录树.
    - 目录树结构当然是和OS文件系统中的结构一致的.
    - 重点是：节点中的对象都是**被跟踪**的.
  2. 和工作区的区别就是，**工作区可能包含未被跟踪的对象**，但节点中的所有内容**一定都是被跟踪的**.


- 微观上看：
  1. 版本库中的节点中的内容永远无法被修改，只能插入或删除一整个节点，对其的操作都是以节点为单位的.
  2. stage节点中的内容可以被修改，通过git add、git mv等git文件操作（跟踪操作）更新stage目录树中的文件.
    - 但这种“修改”是以**文件**为单位的.
      - 你并不能进入.git/的stage中修改stage节点（目录树）中某个文件的某几行.
      - 你只能通过git add等命令将工作区文件**覆盖**stage中的相应文件.
        - 如果是git rm则会直接将stage中的指定文件删除，这样提交时节点中不包含该文件了.
    - 过去学习时常存在的误区是-“stage中保存的是对工作区的修改而不是完整的文件”-，这是错误的，stage和版本库中的节点一样，都是保存了一个完整的版本代码目录树.

<br><br>

### 三、设计stage的好处：可以更好的管理阶段性开发过程  [·](#目录)
> 与很多其它版本控制软件不同的是git多了一个stage.

- 假设你在1小时前（开工前）的代码存入stage，然后在开工后1小时总结一下自己的成就，写一个阶段性文档，这个时候就拿当前代码和stage中的代码比较一下就可以轻松总结出做了哪些改变.
  1. 你可能会说为什么不直接将开工前的代码保存直接保存在版本库中呢？保存在stage明显不安全，stage是单节点的，无法追溯历史.
    - 答案是，版本库只能保存“完整的产品”，即完成了一系列功能模块并测试达标后才能作为一整个节点提交到版本库中.
    - 上述情况顶多就是一个阶段性的工作，有可能连一个模块儿都没有开发完，如果把这些琐碎的阶段性工作都保存在版本库中那版本库岂不是乱套了，管理混乱至极.
  2. 那么对于那些没有提供stage的版本管理软件来说，**git提供了一个可以进行阶段性总结的机会**！
    - 当然阶段性总结只是一个简单的例子，还有更加现实的情况是，有可能你连一个功能或模块只开发了1/3的时候就被老板调去干其它工作了，而你手上未完成的工作必须交给另一个员工继续.
    - 如果没有stage，那你只能临时手写几个“交代文档”或难看的注释告诉接班人你已完成了那些内容，还有哪些内容需要继续填补.
      - 但如果有了stage，就无需那么麻烦了，接班人直接查看一下当前工作区和上一阶段（stage中保存的）的差别就能自己轻松知晓目前进行到哪一步了.
