# 后处理器
> *PostProcessor，是一种功能增强机制.*<br>
> *这里介绍两类后处理器，一种是bean后处理器，另一种是容器后处理器，分别对bean的功能以及Spring容器的功能进行扩展.*
> - **bean后处理器的主要作用是生成bean的代理.**<br>
> - **容器后处理器的主要作用是让配置数据和依赖分离.**<br>

<br><br>

## 目录
1.

<br><br>

### 一、bean后处理器：
- 主要功能：
  1. 并**不对外提供服务**，只负责对Spring**容器中的bean**进行**增强扩展**.
  2. 由于其被设计的主要目的不是对外服务，而是在后台自动增强bean，因此其无须提供id，容器可以**自动识别**并**注册**它，然后在所有bean创建后使其生效.


- 实现：
  1. bean后处理器是一种特殊的bean，必须实现BeanPostProcessor接口.
  2. 必须要实现的两个方法：

```java
Object postProcessBeforeInitialization(Object bean, String name);  // 在bean创建后自动调用
Object postProcessAfterInitialization(Object bean, String name); // 在bean初始化之后自动调用
```

- bean是要增强的bean的引用，name是该bean的id，这两个信息都可以在这两个方法中加以利用.
- bean后处理器设计完后只需要在bean.xml中简单地配置就行，无需id，一旦Spring检测到该bean实现了BeanPostProcessor接口，就会把它当成后处理器，会**先于其它所有bean加载它**，然后在其它bean创建后自动运行.

```html
<bean class="org.lirx.app.util.MyBeanPostProcesser"/>
```

**完整的bean初始化过程：**

- 如果开启bean后处理器的同时，一个bean也实现了InitializingBean同时也声明init-method方法，那么完整的bean初始化过程是按照这样的顺序进行的：


        1. 创建一个空的bean.
        2. setter设值，注入依赖关系.
        3. 后处理器增强：beforeInitialization
        4. InitializingBean-afterPropertiesSet
        5. init-method.
        6. 初始化完毕，后处理器增强：afterInitialization


- 因此看上去貌似后处理器仅仅就是让bean的初始化过程多了两步而已，但是它最重要的一个功能是InitializingBean和init-method无法办到的，就是它可以**返回一个bean实例**，而这个返回的bean实例将作为之后继续处理的bean（InitializingBean、init-method接下来的处理）以及最终交给用户的bean（afterInitialization）**可以是一个完全不同的bean**.
- 因此，bean后处理器最常见的用法就是**生成bean的代理**.
- 示例：

```java
Object postProcessBeforeInitialization(Object bean, String name) {
    ProxyBean proxy = 生成bean的代理;
    return proxy;
}
```
