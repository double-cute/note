# 类似知乎的问答社交网站

- 主要功能模块：
   1. 登录/注册.
   2. 问题发布.
   3. 评论中心：可以看到每个问题底下的所有评论.
   4. 站内信.

## 模块介绍：

### 一、注册登录：

- 特色：用户可限时免密登录、密码（加盐（即使短密码也无法用公库破解）+ MD5加密）
- 技术实现：Ticket门票、TicketHolder
   1. 拦截器：在请求到来的最前端从Cookie中读取Ticket，持有Ticket的用户视为之前登陆过，不用输入密码登录，直接跳到个人主页.
   2. 登录、注册的控制器：在成功登录、注册后服务器随机生成一张Ticket下发到用户的Cookie，供其凭票入场，免输密码.
      - 成功返回Ticket，失败返回错误消息（通过map传递）.
   3. TicketHolder：ThreadLocal包装的User Model，每个服务线程只能拥有一个，拦截Ticket Cookie后根据Ticket信息查询到持票的用户，之后需要用户身份的所有操作都直接从TicketHolder中调出用户信息.

### 二、问题发布 + 评论中心：

1. 登陆后可发布问题，/* 可显示在公共主页和个人主页上（类似朋友圈可以看到自己发的状态） \*/

2. 点击一个问题可以进入该问题的详情页面，即评论中心，可以看到：
   1. 问题本身的内容
   2. 问题的所有评论（按时间顺序排列，从新到旧）
   3. 底下的编辑快可以编写对该问题的评论并发表，发表完后刷新页面看到最新的评论.
   4. 评论的评论待开发.

### 三、站内信：

- 一个单独的模块，提供在本站之内，用户之间的通信.
   1. 用户与用户之间以会话作为通信单位，会话中包含两人之间往来的所有消息.
   2. 会话有两者的身份（user_id）唯一确定.
   3. 发送私信后以及点击私信按钮都可以进入个人私信列表总览页：
      1. 以会别人的会话为单位列出所有会话（从最近到最远）.
      2. 每个会话以该会话中最近一次消息作为代表显示.
      3. 交表显示会话中未读消息的个数.
   4. 点击会话后进入会话详情页面，里面有和另一个用户的所有通信消息的具体内容，头像以发出者作为代表，消息从近到远罗列.

### 二、页面显示：ViewObject

### 三、内容过滤：

- 运用于问题发布、评论发布等发布内容的地方.
- 作用：敏感词过滤 + HTML标签过滤（转义，防止用户注入脚本）
- 特色：过滤敏感词时可以忽略夹在敏感词中间的特殊符号.
   - 例如：'赌ª¢™º博'也可以被识别.
   - 实现方法：
      1. 用敏感词构造字典树.
      2. 过滤时使用indexNode、matchBegin、index三个指针.

### 四、Redis：
关注一下discard事务回滚


1. 使用集合set实现评论的赞踩：赞1个集合，踩1个集合，集合里面放的是赞踩的用户
   - 使用set可避免重复点赞，保证1个用户对1个实体最多累计赞1次.
2. 异步框架：采用Redis的lPush和brPop实现消息队列
   1. 赞踩后重新计算成就值.
   2. 赞后发邮件之类的.
   3. 所有action后特别繁重的工作都需要异步化.
      - 同步可能等待时间较长，体验较差，因此需要异步化
3. 项目中使用异步消息队列的模块：
   1. 点赞后通过系统管理员给被点赞的用户发送站内信通知.
   2.
4. 异步消息队列的实现：即一个手工实现的异步消息/监听模块
   1. 生产者-消费者模型.
   2. 用户的输入会调用生产者产生相应的事件加入消息队列中.
   3. 消费者死循环brPop阻塞取出消息队列中的事件并分发给相应事件的handler处理.


### 新鲜事：

拉：读写数据库，慢！适合小号拉大号
1. 用户产生新鲜事.
2. 将新鲜事入库.
3. 粉丝登录/刷新页面后，主动从数据库中读取他关注的实体写入的新鲜事

推：更具时效性
1. 用户产生新鲜事
2. 将新鲜事推到粉丝的timeline-redis-队列中
3. 用户登录/刷新页面后，直接从redis队列中读取刚刚推入的那些新鲜事.
4. 缺点：一旦取关了以后还需要同步更新（删除）redis队列中被取关之前的新鲜事.
   - 后台压力较大，但时效性强.
